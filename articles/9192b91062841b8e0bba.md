---
title: "Flutterã§æ–°è¦ã‚¢ãƒ—ãƒªä½œã‚‹æ™‚ã«ã‚„ã‚‹ã“ã¨ã¾ã¨ã‚"
emoji: "ğŸ›«"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Flutter, Firebase]
published: true
---

# ã¯ã˜ã‚ã«

Flutterã§æ–°è¦ã«ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹æ™‚ã«ãƒ†ãƒ³ãƒ—ãƒ¬çš„ã«å¤§ä½“åŒã˜ã‚ˆã†ãªäº‹ã‚’ã‚„ã£ã¦ã„ã‚‹ãŒã€ã„ã¤ã‚‚å¿˜ã‚Œã‚‹ã®ã§å‚™å¿˜éŒ²ã¨ã—ã¦ã¾ã¨ã‚ã€‚
Flutterã¯çµ¶è³›é–‹ç™ºä¸­ãªã®ã§ã€æœ¬ç¨¿ã®å†…å®¹ã¯å½“æ™‚ã“ã‚Œã§ã†ã¾ãã„ã£ã¦ã„ãŸãã‚‰ã„ã«ç•™ã‚ã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚
ã¾ãŸã€æœ¬ç¨¿ã¯å€‹äººçš„ãªãƒ¡ãƒ¢ã®æ„å‘³åˆã„ãŒå¼·ã„ãŸã‚ã€å‰²æ„›ã—ã¦ã„ã‚‹èª¬æ˜ãŒå¤šã€…ã‚ã‚Šã¾ã™ã€‚

æœ¬ç¨¿ã®å¤‰æ›´ã‚’é©ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¯[ã“ã¡ã‚‰](https://github.com/KoheiKanagu/my_flutter_app_template)

[è¨˜äº‹ã‚‚ãƒ†ãƒ³ãƒ—ãƒ¬è‡ªä½“ã‚‚éšæ™‚æ›´æ–°äºˆå®š](https://github.com/KoheiKanagu/my_flutter_app_template/issues?q=is%3Aissue+sort%3Aupdated-desc+is%3Aopen)

æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è¨˜äº‹ã¯ã“ã¡ã‚‰ï¼š[Flutterã§æ–°è¦ã‚¢ãƒ—ãƒªä½œã‚‹æ™‚ã«ã‚„ã‚‹ã“ã¨ã¾ã¨ã‚ \- Qiita](https://qiita.com/KoheiKanagu/items/516f43686b3f96fc3022)

## ã“ã®è¨˜äº‹ã§ã§ãã‚‹ã“ã¨è¦ç´„

- å¤§ä½“ã‚¢ãƒ—ãƒªä½œã‚‹ã¨ãã«ã‚„ã‚‹ã§ã‚ã‚ã†æ‰‹é †ã®å‚™å¿˜éŒ²
- dart-defineã‚’ç”¨ã„ã¦é–‹ç™ºç’°å¢ƒã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã€æœ¬ç•ªç’°å¢ƒã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆã€åˆ¥ã€…ã®ã‚¢ãƒ—ãƒªã¨ã—ã¦ç‹¬ç«‹ã•ã›ã‚‹æ–¹æ³•
- ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã«å¿œã˜ã¦åˆ©ç”¨ã™ã‚‹Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹æ–¹æ³•
- ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬ã®Tips
- GitHub Actionsã‚’ç”¨ã„ã¦ã€Firebase App Distributionã§ã‚¢ãƒ—ãƒªã‚’é…å¸ƒã™ã‚‹æ–¹æ³•
- GitHubãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰å„ã‚¹ãƒˆã‚¢ã«ç”³è«‹ã§ãã‚‹`.ipa`ã‚„`.aab`ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ–¹æ³•
- ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã§ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•

## ç’°å¢ƒ

```txt
Flutter 2.5.2 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision 3595343e20 (10 days ago) â€¢ 2021-09-30 12:58:18 -0700
Engine â€¢ revision 6ac856380f
Tools â€¢ Dart 2.14.3
```

## Flutter Create

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã€‚

```sh
flutter create --org com.example your_project_name
```

orgã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚„Androidã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãªã©ã«å½±éŸ¿ã™ã‚‹ãŸã‚ã€å¾Œã‹ã‚‰å¤‰æ›´ã™ã‚‹ã®ã¯é¢å€’ãªã®ã§æ³¨æ„ã€‚

## Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œã‚‹

[Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.firebase.google.com/)ã‹ã‚‰ä½œæˆã™ã‚‹ã€‚
`ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ç¢ºèª`ã¨ã„ã†ç–é€šç¢ºèªã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã¨ã‚Šã‚ãˆãšç„¡è¦–ã€‚

iOSã¨Androidã‚¢ãƒ—ãƒªã‚’ãã‚Œãã‚Œè¿½åŠ ã—ã€ã‚¢ãƒ—ãƒªIDã¯å¾Œã»ã©ä½¿ã†ã®ã§ãƒ¡ãƒ¢ã—ã¦ãŠãã€‚

Firestoreã‚„App Distributionã‚’åˆ©ç”¨ã™ã‚‹ãªã‚‰äºˆã‚Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰æœ‰åŠ¹ã«ã—ã¦ãŠãã“ã¨ã‚’å¿˜ã‚Œãšã«ã€‚

é–‹ç™ºç’°å¢ƒã‚„æœ¬ç•ªç’°å¢ƒãªã©ã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼æ¯ã«ãã‚Œãã‚Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ãŠãã“ã¨ã€‚

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®GCPãƒªã‚½ãƒ¼ã‚¹ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³

æ±äº¬ã¯`asia-northeast1`

### Firebaseã®æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«

æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ãƒãƒãƒƒã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ã„ã„ãŒã€[firebase ã‚³ãƒãƒ³ãƒ‰](https://firebase.google.com/docs/cli?hl=ja)ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚‚ã§ãã‚‹ã®ã§ã€[ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/KoheiKanagu/my_flutter_app_template/blob/master/scripts/downloadFirebaseAppConfiguration.sh)ã‚’æ›¸ã„ã¦ãŠãã¨æ¥½ã€‚
ï¼ˆã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯å¾Œè¿°ã™ã‚‹Flavorå¯¾å¿œã®ãŸã‚ã«é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«åã§é…ç½®ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ï¼‰

## iOS

### CFBundleNameã¨CFBundleDisplayName

Info.plistã®CFBundleNameã¨CFBundleDisplayNameã‚’å¤‰æ›´ã™ã‚‹ã€‚
`PRODUCT_NAME`ã«ã—ã¦ãŠãã¨exportã™ã‚‹éš›ã«`Runner.ipa`ã¨ãƒ•ã‚¡ã‚¤ãƒ«åãŒå›ºå®šã•ã‚Œã‚‹ã®ã§éƒ½åˆãŒã„ã„ã€‚

```diff:ios/Runner/Info.plist
  <key>CFBundleName</key>
- <string>ã‚¢ãƒ—ãƒªã®åå‰</string>
+ <string>$(PRODUCT_NAME)</string>
...
+ <key>CFBundleDisplayName</key>
+ <string>$(APP_NAME)</string>
```

### è¼¸å‡ºã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹

ã€Œã„ã„ãˆã€ã¨ç­”ãˆã‚‹å ´åˆã¯Info.plistã«ã‚ã‚‰ã‹ã˜ã‚è¿½è¨˜ã—ã¦ãŠãã¨æ‰‹å‹•ã§ã„ã„ãˆã™ã‚‹å¿…è¦ãŒãªã„ã®ã§æ¥½ã€‚

```diff:ios/Runner/Info.plist
+ <key>ITSAppUsesNonExemptEncryption</key>
+ <false/>
```

![ã‚¹ã‚¯ã‚·ãƒ§](https://storage.googleapis.com/zenn-user-upload/1yq5u7jmbcrwy07qr9usfnubfitc)

### Bundle Identifierã®Suffix

Runnerã®Build Settingsã‹ã‚‰Product Bundle Identifierã‚’æ¤œç´¢ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«`APP_SUFFIX`ã‚’è¿½è¨˜ã€‚

```diff:ios/Runner.xcodeproj/project.pbxproj
- PRODUCT_BUNDLE_IDENTIFIER = com.example.app;
+ PRODUCT_BUNDLE_IDENTIFIER = "com.example.app$(APP_SUFFIX)";
```

### dart-defineã‹ã‚‰ã®å¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€ä¸‹æº–å‚™

æ¬¡ã«Runnerã®Schemeã‚’Editã—ã¦ã€Buildã®Pre-actionsã«æ¬¡ã®RunScriptã‚’è¿½åŠ ã™ã‚‹ã€‚

```sh
function urldecode() {
    : "${*//+/ }"
    echo "${_//%/\\x}"
}

IFS=',' read -r -a define_items <<<"$DART_DEFINES"

for index in "${!define_items[@]}"; do
    define_items[$index]=$(urldecode "${define_items[$index]}")
done

printf "%s\n" "${define_items[@]}" | grep '^APP_' >>${SRCROOT}/Flutter/Generated.xcconfig
```

Provide build settings fromã¯`Runner`ã‚’é¸æŠã™ã‚‹ã€‚

### Provisioning Profile

ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§Provisioning Profileã‚’ç®¡ç†ã—ãŸã„ã®ã§Signingã®Automatically manage signingã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ã€‚

![ã‚¹ã‚¯ã‚·ãƒ§](https://storage.googleapis.com/zenn-user-upload/0m20b23m06i3b210npl70ppycy9j)

Build Settingsã‹ã‚‰Provisioning Profileï¼ˆ`PROVISIONING_PROFILE_SPECIFIER`ï¼‰ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã€‚

```diff:ios/Runner.xcodeproj/project.pbxproj
- PROVISIONING_PROFILE_SPECIFIER = "";
+ PROVISIONING_PROFILE_SPECIFIER = "$(APP_PROVISIONING_PROFILE_SPECIFIER)";
```

Build Settingsã‹ã‚‰Development Teamï¼ˆ`DEVELOPMENT_TEAM`ï¼‰ã‚’é©åˆ‡ãªãƒãƒ¼ãƒ ã«å¤‰æ›´ã™ã‚‹ã€‚

```diff:ios/Runner.xcodeproj/project.pbxproj
+ DEVELOPMENT_TEAM = XXXXXXXXXX;
```

Build Settingsã‹ã‚‰Code Signing Identityï¼ˆ`CODE_SIGN_IDENTITY`ï¼‰ã‚’å…¨ã¦åˆ©ç”¨ã™ã‚‹Provisioning Profileã«é–¢é€£ã—ãŸApple Distributionã¸å¤‰æ›´ã™ã‚‹ã€‚

`Apple Distribution`ã§ã‚‚å•é¡Œãªããƒ“ãƒ«ãƒ‰ãŒé€šã‚‹å ´åˆã‚‚ã‚ã‚‹ãŒã€ã‚ãã¾ã§`Apple Distribution`ã¯è¨¼æ˜æ›¸ã‚’è‡ªå‹•ã§é¸æŠã™ã‚‹ã‚‚ã®ãªã®ã§ã€ãŸã¾ãŸã¾ã†ã¾ãè¡Œã£ã¦ã„ã‚‹ã«éããªã„ã€‚

```diff:ios/Runner.xcodeproj/project.pbxproj
+ CODE_SIGN_IDENTITY = "Apple Distribution: Kohei Kanagu (4XBP3H82S7)";
```

### GoogleService-Info.plist

Firebaseã®SDKã¯`ios/Runner/GoogleService-Info.plist`ã‚’è‡ªå‹•ã§èª­ã¿è¾¼ã‚€ã®ã§ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã«å¿œã˜ã¦å·®ã—æ›¿ãˆã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ã¾ãšé©å½“ãªå†…å®¹ã§`GoogleService-Info.plist`ã‚’ä½œã£ã¦ã€Xcodeã®Project Navigatorã§Runnerãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã«ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦`GoogleService-Info.plist`ã¸ã®å‚ç…§ã‚’ä½œã£ã¦ãŠãã€‚

```sh
echo '
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
</dict>
</plist>
' > ios/Runner/GoogleService-Info.plist
```

æ¬¡ã«ã€Build Phasesã®New Run Script Phaseã§[GoogleService\-Info\.plist ã‚’ Flavor æ¯ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ RunScript dart\-define ã‚’ä½¿ã£ãŸå ´åˆ](https://gist.github.com/KoheiKanagu/82d18621ca57e96a0a4e4a456383c006)ã‚’ã‚³ãƒ”ãƒšã€‚

ä½œã£ãŸRun Scriptã®`Output Files`ã«ã¯ä»¥ä¸‹ã‚’è¿½åŠ ã—ã€`Copy Bundle Resources`ã‚ˆã‚Šã‚‚ä¸Šã«é…ç½®ã™ã‚‹ã€‚

```txt
$SRCROOT/Runner/GoogleService-Info.plist
```

æœ€å¾Œã«ã€`ios/Runner/GoogleService-Info.plist`ã‚’gitignoreã«è¿½åŠ ã™ã‚‹ã€‚

```sh
echo "ios/Runner/GoogleService-Info.plist" >> .gitignore
```

### Runner.entitlements

ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼æ¯ã«Associated Domainsã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã€`com.apple.developer.associated-domains`ã®å€¤ã¯å¤‰æ•°ã«ã—ã¦ãŠãã€å¾Œè¿°ã®`dart-define`ã§æ¸¡ã™ã€‚

```xml:./ios/Runner/Runner.entitlements
<key>com.apple.developer.associated-domains</key>
<array>
    <string>${APP_ASSOCIATED_DOMAIN}</string>
</array>
```

App Groupsãªã©ã§ã‚‚åŒæ§˜ã€‚

### ã‚¢ãƒ—ãƒªã®æ¨™æº–è¨€èªã‚’æ—¥æœ¬èªã«ã™ã‚‹

```diff:ios/Runner.xcodeproj/project.pbxproj
- developmentRegion = en;
+ developmentRegion = ja;
  knownRegions = (
-     en,
+     ja,
      Base,
  );
```

### ã‚µãƒãƒ¼ãƒˆã™ã‚‹iOSãƒãƒ¼ã‚¸ãƒ§ãƒ³

Runnerã®Infoã®`iOS Deployment Target`ã‚’[AppleãŒç®—å‡ºã—ã¦ã„ã‚‹ã‚·ã‚§ã‚¢ç‡](https://developer.apple.com/support/app-store/)ã‚’å‚è€ƒã«ã—ã¦å¤‰æ›´ã™ã‚‹ã€‚

`ios/Podfile`ã®æœ€ä¸Šéƒ¨ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã‚ã‚‹platformã‚‚åŒã˜å€¤ã«å¤‰æ›´ã€‚

```Podfile:ios/Podfile
# Uncomment this line to define a global platform for your project
# platform :ios, '9.0' â†ã“ã‚Œ
```

æœ€ä¸‹éƒ¨ã®post_installã®ä¸­èº«ã‚’æ¬¡ã®ã‚ˆã†ã«`IPHONEOS_DEPLOYMENT_TARGET`ã‚’æŒ‡å®šã™ã‚‹ã€‚

```Podfile:ios/Podfile
post_install do |installer|
  installer.pods_project.targets.each do |target|
    flutter_additional_ios_build_settings(target)
    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '12.3'
    end
  end
end
```

ãªãŠã€Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œã‚ŠãŸã¦ã®æ™‚ç‚¹ã§ã¯`ios/Podfile`ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ã«ä¸€æ—¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ç”Ÿæˆã•ã‚Œã‚‹ã€‚

```sh
flutter build ios --config-only
```

### Bitcodeã®ã‚µãƒãƒ¼ãƒˆ

Build Settingsã‹ã‚‰`Enable Bitcode`ã‚’`YES`ã«ã™ã‚‹ã€‚

### iOSã®å‚è€ƒæ–‡çŒ®

- [Flutter 1\.17 â€” no more Flavors, no more iOS Schemas\. Command argument that changes everything \| by Denis Beketsky \| ITNEXT](https://itnext.io/flutter-1-17-no-more-flavors-no-more-ios-schemas-command-argument-that-solves-everything-8b145ed4285d)
- [dart\-define ã§ Flutter ã‚¢ãƒ—ãƒªã® Firebase é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã‚’ä½¿ã„åˆ†ã‘ã‚‹ iOS ç·¨ \- Qiita](https://qiita.com/tetsufe/items/3f2257ac12f812d3f2d6)
- [ãƒ“ãƒ«ãƒ‰ç’°å¢ƒã«ã‚ˆã‚‹ App Groups ã‚’å¤‰æ›´ã™ã‚‹è¨­å®šæ–¹æ³• \- Qiita](https://qiita.com/dolfalf/items/3db85bdae0c18985314a)
- [iOS10ã®ã‚µãƒãƒ¼ãƒˆã‚’åˆ‡ã‚‹ã¨ãã«ã‚„ã£ãŸã“ã¨ \- Qiita](https://qiita.com/orimomo/items/299712d5b67214143613)
- [Creating an iOS Bitcode enabled app Â· flutter/flutter Wiki](https://github.com/flutter/flutter/wiki/Creating-an-iOS-Bitcode-enabled-app)
- [Xcode ã§ã‚¢ãƒ—ãƒªã®æ¨™æº–è¨€èªã‚’æ—¥æœ¬èªã«ã™ã‚‹æ–¹æ³• \- Qiita](https://qiita.com/ko2ic/items/8918034d940f66fee97d)
- [iOS Installation \| FlutterFire](https://firebase.flutter.dev/docs/installation/ios)
- [flutter 1\.19 parse sh script](https://gist.github.com/TatsuUkraine/99d2af08f6dfef17982299afa56f6507#file-ios_parse-sh)

## Android

### ç½²å

keystoreã¯AndroidStudioã§ç”Ÿæˆã™ã‚‹ã‹ã€æ¬¡ã®ã‚ˆã†ã«ä½œæˆã™ã‚‹ã€‚

```sh
keytool -genkey -v -keystore release.keystore -alias key0 -keyalg RSA -keysize 2048 -validity 10000
keytool -importkeystore -srckeystore release.keystore -destkeystore release.keystore -deststoretype pkcs12
```

å¾Œè¿°ã®`android/app/build.gradle`ã§æŒ‡å®šã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€`android/app/release.keystore`ã«ç½®ã„ã¦ãŠãã€‚

ãªãŠ2ã¤ç›®ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨`release.keystore.old`ãŒãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã‚‹ãŒç‰¹ã«ä½¿ã‚ãªã„ã®ã§å‰Šé™¤ã—ã¦ã‚‚è‰¯ã„ã€‚

SHAã¯æ¬¡ã®ã‚ˆã†ã«æ±‚ã‚ã¦Firebaseã«ç™»éŒ²ã—ã¦ãŠãã€‚

```sh
keytool -list -v -alias key0 --keystore release.keystore
```

### build.gradle

`signingConfigs`ã«keystoreã‚’è¿½è¨˜ã—ã€releaseãƒ“ãƒ«ãƒ‰æ™‚ã«åˆ©ç”¨ã™ã‚‹ã€‚
keystoreã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…è¦ã«å¿œã˜ã¦éš ãã†ã€‚
å‚è€ƒï¼š[ä»Šæ›´ãªãŒã‚‰ Android ã® keystore ã¨ ç½²å\(signingConfigs\) ã®ç®¡ç†ãƒ»é‹ç”¨ã«ã¤ã„ã¦è€ƒãˆã¦ã¿ãŸ \- Qiita](https://qiita.com/taki4227/items/c5685ec722a195764237)

```groovy:android/app/build.gradle
signingConfigs {
    release {
        storeFile file("release.keystore")
        storePassword "android"
        keyAlias "key0"
        keyPassword "android"
    }
}

buildTypes {
    release {
        signingConfig signingConfigs.release
    }
}
```

### ã‚¢ãƒ—ãƒªå

labelã‚’æ¬¡ã®ã‚ˆã†ã«ä¿®æ­£ã€‚

```xml:android/app/src/main/AndroidManifest.xml
<application
    android:label="@string/app_name">
```

`dart-define`ã‹ã‚‰ã®å…¥åŠ›ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã‚»ãƒƒãƒˆã™ã‚‹ã€‚

```groovy:android/app/build.gradle
def dartEnvironmentVariables = [
        APP_NAME: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ',
        APP_SUFFIX: null,
        APP_ENV: 'default'
]

if (project.hasProperty('dart-defines')) {
    dartEnvironmentVariables = dartEnvironmentVariables + project.property('dart-defines')
            .split(',')
            .collectEntries { entry ->
                def pair = URLDecoder.decode(entry).split('=')
                [(pair.first()): pair.last()]
            }
}
android {
...
    defaultConfig {
        applicationIdSuffix dartEnvironmentVariables.APP_SUFFIX
        resValue "string", "app_name", dartEnvironmentVariables.APP_NAME
    }
...
}
```

### google-services.json

Firebaseã®SDKã¯`android/app/google-services.json`ã‚’è‡ªå‹•ã§èª­ã¿è¾¼ã‚€ã®ã§ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã«å¿œã˜ã¦å·®ã—æ›¿ãˆã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¦ã€ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã«å¿œã˜ãŸ`google-services.json`ã‚’é…ç½®ã™ã‚‹ã€‚

```groovy:android/app/build.gradle
task copyGoogleServicesJson(type: Copy) {
    from "google-services-${dartEnvironmentVariables.APP_ENV}.json"
    into './'
    rename "(.+)-${dartEnvironmentVariables.APP_ENV}.json", '$1.json'
}

tasks.whenTaskAdded { task ->
    if (task.name == 'processDebugGoogleServices') {
        task.dependsOn copyGoogleServicesJson
    }
    if (task.name == 'processReleaseGoogleServices') {
        task.dependsOn copyGoogleServicesJson
    }
}
```

æœ€å¾Œã«`android/app/google-services.json`ã¯Flavorã‚’å¤‰ãˆã‚‹æ¯ã«å¤‰æ›´ã•ã‚Œã‚‹ã®ã§gitignoreã«è¿½åŠ ã—ã¦ãŠãã€‚

```sh
echo "android/app/google-services.json" >> .gitignore
```

### ã‚µãƒãƒ¼ãƒˆã™ã‚‹Androidãƒãƒ¼ã‚¸ãƒ§ãƒ³

Flutter 2.0.6æ™‚ç‚¹ã§ã¯minSdkVersionã®åˆæœŸå€¤ã¯16ã ãŒã€ã„ãã‚‰ãªã‚“ã§ã‚‚ä½ã™ãã‚‹ã®ã§ä¸Šã’ã‚‹ã€‚
å°‘ãªãã¨ã‚‚[google\_mobile\_ads](https://pub.dev/packages/google_mobile_ads)ãªã©ã¯19ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ã‚·ã‚§ã‚¢5%ã‚’åˆ‡ã£ãŸã‚‰åˆ‡ã‚‹ãã‚‰ã„ã‹ã€‚

- [OSä¸€è¦§ï¼ˆAndroidï¼‰ \| ã‚¹ãƒšãƒƒã‚¯æ¤œç´¢ã¨ã‚·ã‚§ã‚¢ç‡ãŒå½¹ç«‹ã¤å›½å†…ã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆæ©Ÿç¨®æƒ…å ±ã‚µã‚¤ãƒˆ](http://smatabinfo.jp/os/android/index.html)
- [@minSdkVersion / Twitter](https://twitter.com/minSdkVersion)

### Androidã®å‚è€ƒæ–‡çŒ®

- [Flutter 1\.17 â€” no more Flavors, no more iOS Schemas\. Command argument that changes everything \| by Denis Beketsky \| ITNEXT](https://itnext.io/flutter-1-17-no-more-flavors-no-more-ios-schemas-command-argument-that-solves-everything-8b145ed4285d)
- [dart\-define ã§ Flutter ã‚¢ãƒ—ãƒªã® Firebase é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã‚’ä½¿ã„åˆ†ã‘ã‚‹ Android ç·¨ \- Qiita](https://qiita.com/tetsufe/items/29cc779592171dcfb7aa)
- [ãƒ“ãƒ«ãƒ‰ç’°å¢ƒã«ã‚ˆã‚‹ App Groups ã‚’å¤‰æ›´ã™ã‚‹è¨­å®šæ–¹æ³• \- Qiita](https://qiita.com/dolfalf/items/3db85bdae0c18985314a)
- [android \- How can I create a keystore? \- Stack Overflow](https://stackoverflow.com/a/15330139/12856415)
- [Authenticating Your Client Â \|Â  Android ç”¨ Google API Â \|Â  Google Developers](https://developers.google.com/android/guides/client-auth)

## dart-define

å‰è¿°ã—ã¦ããŸãƒ•ãƒ¬ãƒ¼ãƒãƒ¼æ¯ã«å¤‰ãˆã‚‹`APP_*`ã®ã‚ˆã†ãªå¤‰æ•°ã¯ã€dart-defineã§iOSã€Androidãã‚Œãã‚Œãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«é©ç”¨ã™ã‚‹ã€‚

### flutter build

ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦`dart-define`ã§å€¤ã‚’æ¸¡ã™
ï¼ˆ`APP_NAME="devã‚¢ãƒ—ãƒª"`ã®ã‚ˆã†ã«ã™ã‚‹ã¨`"`ã¾ã§æ¸¡ã•ã‚Œã¦ã—ã¾ã†ã®ã§æ³¨æ„ï¼‰
ï¼ˆ`APP_ASSOCIATED_DOMAIN`ãŒä¸è¦ã®å ´åˆã¯`--dart-define APP_ASSOCIATED_DOMAIN=""`ã§ã¯ãªãå‰Šé™¤ã™ã‚‹ï¼‰

```sh
flutter build ios \
    --dart-define APP_NAME=devã‚¢ãƒ—ãƒª \
    --dart-define APP_SUFFIX=.dev \
    --dart-define APP_ENV=dev \
    --dart-define APP_ASSOCIATED_DOMAIN=applinks:com.example.page.link
```

Flutterå´ã§å€¤ã‚’ä½¿ã„ãŸã„ãªã‚‰ã“ã®ã‚ˆã†ã«ã™ã‚‹ã€‚ï¼ˆfinalã§ã¯ãªãconstã«ã™ã‚‹ã“ã¨ï¼‰

```dart
const appName = String.fromEnvironment('APP_NAME', defaultValue: 'unknownName');
const appSuffix = String.fromEnvironment('APP_SUFFIX', defaultValue: 'unknownSuffix');
const appEnv = String.fromEnvironment('APP_ENV', defaultValue: 'unknownEnv');
```

### Visual Studio Code

[launch.json ã®ä¾‹](https://github.com/KoheiKanagu/my_flutter_app_template/blob/master/.vscode/launch.json)

```json
{
  "name": "dev",
  "request": "launch",
  "program": "lib/main.dart",
  "type": "dart",
  "args": [
    "--dart-define=APP_NAME=devã‚¢ãƒ—ãƒª",
    "--dart-define=APP_SUFFIX=.dev",
    "--dart-define=APP_ENV=dev",
    "--dart-define=APP_ASSOCIATED_DOMAIN=applinks:com.example.page.link"
  ]
}
```

## FlutterFire

[FlutterFire Overview \| FlutterFire](https://firebase.flutter.dev/docs/overview)ã‚’å‚è€ƒã«ã—ã¦å°å…¥ã™ã‚‹ã€‚
iOS/Androidãã‚Œãã‚Œã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚‚å¿˜ã‚Œãšã«ã€‚

### Crashlytics

iOSã§Crashlyticsã‚’å°å…¥ã™ã‚‹éš›ã€`${PODS_ROOT}/FirebaseCrashlytics/run`ã®Scriptã¯æœ€å¾Œã«é…ç½®ã™ã‚‹ã€‚
![ã‚¹ã‚¯ã‚·ãƒ§](https://storage.googleapis.com/zenn-user-upload/4isb5r9mtw8yxahreiuvpxt0ged0)

å‚è€ƒï¼š[Firebase Crashlytics ã‚’ä½¿ã£ã¦ã¿ã‚‹](https://firebase.google.com/docs/crashlytics/get-started?hl=ja&platform=ios#initialize-crashlytics)

### dSYMã®æ‰‹å‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

Bitcodeã‚’æœ‰åŠ¹ã«ã—ã¦ã„ãŸå ´åˆã¯ã€App Storeã‹ã‚‰dSYMã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦æ‰‹å‹•ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
[dSYMã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/KoheiKanagu/my_flutter_app_template/blob/master/scripts/uploadSymbols.sh)

å‚è€ƒï¼š[Firebase Crashlytics SDK ã‚’ä½¿ç”¨ã—ã¦é›£èª­åŒ–è§£é™¤ã•ã‚ŒãŸã‚¯ãƒ©ãƒƒã‚·ãƒ¥ ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—ã™ã‚‹](https://firebase.google.com/docs/crashlytics/get-deobfuscated-reports?platform=ios)

## Firestoreã®Improve iOS Build Times

iOSã®Firestore SDKã¯C++ã§50ä¸‡è¡Œã‚ã‚‹ã‚‰ã—ã„ã®ã§ã€æ™®é€šã«å‚ç…§ã™ã‚‹ã¨ãƒ“ãƒ«ãƒ‰ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚
ãã“ã§ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‚ç…§ã™ã‚‹ã¨å¤§å¹…ã«ãƒ“ãƒ«ãƒ‰æ™‚é–“ã‚’çŸ­ç¸®ã§ãã‚‹ã®ã§ãŠã™ã™ã‚ã€‚
å‚è€ƒï¼š[FlutterFire Overview \| FlutterFire](https://firebase.flutter.dev/docs/overview#improve-ios-build-times)

## ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬

ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«`--coverage`ã‚’ä»˜ä¸ã™ã‚Œã°`./coverage/lcov.info`ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚

```sh
flutter test --coverage
```

ãŸã ã—ã€ã“ã‚Œã¯**ãƒ†ã‚¹ãƒˆã®å¯¾è±¡ã«ãªã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã®çµæœã®ã¿**ãŒå‡ºåŠ›ã•ã‚Œã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å…¨ãæ›¸ã„ã¦ã„ãªã„ã¨`lcov.info`ã«ã¯ä½•ã‚‚å‡ºåŠ›ã•ã‚Œãªã„ã€‚
ã¤ã¾ã‚Šå…¨éƒ¨ã®dartãƒ•ã‚¡ã‚¤ãƒ«ã‚’importã™ã‚‹ã ã‘ã®ãƒ†ã‚¹ãƒˆã‚’ç”¨æ„ã—ã¦ãŠã‘ã°ã€å…¨ã¦ã®ã‚³ãƒ¼ãƒ‰ãŒ`lcov.info`ã«å«ã¾ã‚Œã‚‹ã€‚

```dart:test/coverage_test.dart ã®ã‚ˆã†ãªã‚‚ã®
import 'package:example_app/hoge1.dart';
import 'package:example_app/hoge2.dart';
import 'package:example_app/hoge3.dart';

void main() {}
```

æ‰‹å‹•ã§è¿½è¨˜ã—ã¦ã„ãã®ã¯é¢å€’ãªã®ã§[ãƒ˜ãƒ«ãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/KoheiKanagu/dart_full_coverage)ã§ç”Ÿæˆã™ã‚‹ã€‚

```sh
curl https://raw.githubusercontent.com/KoheiKanagu/dart_full_coverage/master/dart-coverage-helper | sh
```

gitignoreã‚‚ã—ã¦ãŠãã€‚

```sh
echo "coverage/lcov.info" >> .gitignore
```

### ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬ã®å‚è€ƒæ–‡çŒ®

- [Flutter test coverage will not report untested files Â· Issue \#27997 Â· flutter/flutter](https://github.com/flutter/flutter/issues/27997)
- [How can I generate test coverage of untested files on my flutter tests? \- Stack Overflow](https://stackoverflow.com/questions/54602840/how-can-i-generate-test-coverage-of-untested-files-on-my-flutter-tests)
- [priezz/dart_full_coverage: Helper for full tests coverage checkup for you Dart/Flutter project](https://github.com/priezz/dart_full_coverage)

## Codecov

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«[codecov\.yml](https://docs.codecov.io/docs/codecov-yaml)ã‚’é…ç½®ã™ã‚Œã°ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã«ã¯å«ã‚ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã§ãã‚‹ãªã©ã€ã„ã‚ã„ã‚è¨­å®šã§ãã‚‹ã€‚
ä¾‹ï¼š[codecov.yml](https://github.com/KoheiKanagu/my_flutter_app_template/blob/master/codecov.yml)

## localizationsDelegates

`GlobalWidgetsLocalizations`ãªã©ã‚’æŒ‡å®šã™ã‚‹ãªã‚‰`pubspec.yaml`ã«è¿½è¨˜ã—ã¦ãŠãã€‚

```dart:main.dart
return MaterialApp(
    localizationsDelegates: const [
    GlobalCupertinoLocalizations.delegate,
    GlobalMaterialLocalizations.delegate,
    GlobalWidgetsLocalizations.delegate,
    ],
);
```

```yaml:pubspec.yaml
dependencies:
  flutter_localizations:
    sdk: flutter
  intl: any
```

## [fvm](https://fvm.app/)

Flutterã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯fvmã§ç®¡ç†ã™ã‚‹ã€‚
gitignoreã¸ã®è¿½åŠ ã¨`.vscode/settings.json`ã®ä¿®æ­£ã‚‚å¿˜ã‚Œãšã«ã€‚

[Configuration \| Flutter Version Management](https://fvm.app/docs/getting_started/configuration/)

```sh
echo ".fvm/flutter_sdk" >> .gitignore
```

## ã‚¢ãƒ—ãƒªã®ã‚¢ã‚¤ã‚³ãƒ³

[flutter\_launcher\_icons \| Dart Package](https://pub.dev/packages/flutter_launcher_icons)ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ãŒã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³0.9.0æ™‚ç‚¹ã§ã¯Androidã®ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–ã‚¢ã‚¤ã‚³ãƒ³å‘¨ã‚Šã§ä¸å…·åˆãŒã‚ã‚‹ãŸã‚å¾®å¦™ã€‚

- [Adaptive Icon Foreground needs to have padding otherwise ends up stretching Â· Issue \#96 Â· fluttercommunity/flutter\_launcher\_icons](https://github.com/fluttercommunity/flutter_launcher_icons/issues/96)
- [Adaptive Icon Scaling by knyghtryda Â· Pull Request \#181 Â· fluttercommunity/flutter\_launcher\_icons](https://github.com/fluttercommunity/flutter_launcher_icons/pull/181)

ã©ã†ã›é »ç¹ã«å¤‰ãˆã‚‹ã‚‚ã®ã§ã‚‚ãªã„ã®ã§ã€[Android Studioã§ç”Ÿæˆ](https://developer.android.com/studio/write/image-asset-studio?hl=ja#create-adaptive)ã—ãŸã‚Šé©å½“ãªã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ã€‚
