---
title: "BLOOMS - AI Agent Hackathon with Google Cloud"
emoji: "🌷"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [flutter, firebase, googlecloud, 生成ai, ハッカソン]
published: false
---

この記事は **[【Zenn 初開催】AI エージェント開発に挑戦！初心者歓迎ハッカソン](https://zenn.dev/hackathons/2024-google-cloud-japan-ai-hackathon)** への提出を目的とした成果報告です。

# BLOOMS

![BLOOMS App Icon](https://storage.googleapis.com/zenn-user-upload/7a3cff684a78-20250206.png =250x)

今回開発したものは「BLOOMS」という iOS/Web アプリケーションです。発音は**ブルームス**です。

BLOOMS は妊婦の方が体調や日々の出来事を記録すると、生成 AI が感想を述べたり、関連情報が得られるであろう Google での検索キーワードを提案したり、一定の期間にどのような記録があったのかを要約してくれるアプリケーションです。

:::message alert
このアプリケーションは医療情報を提供するものではありません。
ただし、生成 AI を利用している都合上、提供する内容を 100%制御することはできないため、あくまで参考程度に止める必要があります。
:::

主な機能としては以下の通りです。

- テキストと写真による体調や日々の出来事の記録
- 生成 AI による記録への感想と検索キーワードの提案
- 一定期間における記録の要約

https://youtu.be/E55mRCPdaK8

動画のナレーションは [Text-to-Speech AI](https://cloud.google.com/text-to-speech?hl=ja) を利用しました。

:::message
デモ動画、および本記事の内容はバージョン`1.0.1`時点のものです。
ハッカソンの審査期間中（〜2025 年 2 月 24 日）には、セキュリティやバグといった重大な問題への対処が必要な場合を除き、アップデートは行いません。
:::

## デモ

Web 版は一部機能が制限されていますが、基本的な動作はどちらも同じです。

### iOS 版

https://apps.apple.com/jp/app/blooms/id6740260241

### Web 版

https://app.blooms.kingu.dev/

## 対象のユーザ像と課題

BLOOMS は妊婦の方が利用することを想定しています。具体的には、妻のために開発したアプリケーションです。

現在、妻が妊娠中であり、体調が変化しやすい状態を目の当たりにしています。辛さを軽減するために取れる対策がないか調べてみたり、医師や助産師に相談してみたりしています。

しかし、いつ、どのような体調の変化があったのかを把握しておかないと、対策を調べたり効果を検証したり、医師に症状を相談するのが難しいとわかりました。
体調は様々な理由で日々変化するため、記憶だけに頼るのは難しく、何らかの記録に残しておく必要があると考えました。

## 課題へのソリューション

世の中には「マタニティダイアリー」と呼ばれる体調を記録したり役立つ情報を参照できる日記があります。

https://st.benesse.ne.jp/ninshin/content/?id=97770
https://www.akachan.jp/mlife/life/2104_01.html

BLOOMS はこれを代替し、さらに生成 AI を用いて記録に対する付加情報の提供や要約を行います。
これにより、ユーザは従来通り体調を記録するだけで、関連する情報を得られるきっかけが提供され、自身の体調についてより深く理解することができると考えています。

### 日々の体調の記録

BLOOMS では、日々の体調や出来事をテキストや写真で記録することができます。
この記録を元にして、生成 AI がユーザを労ったり、より有用な記録となることを支援する文章を生成します。

| テキストの記録                                                                                                               | 画像の記録                                                                                                                   |
| ---------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| ![BLOOMSがテキストの記録に感想を述べている](https://storage.googleapis.com/zenn-user-upload/3858d37456d1-20250208.png =400x) | ![BLOOMSがテキストの記録に感想を述べている](https://storage.googleapis.com/zenn-user-upload/004abd3c7743-20250208.png =400x) |

### 検索キーワード

BLOOMS は記録に関連して、付加情報が得られると推定される検索キーワードを提案することがあります。
この検索キーワードをタップすると Google での検索結果を閲覧することができます。

| 検索キーワードの提案                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------ |
| ![BLOOMSが検索キーワードを提案している](https://storage.googleapis.com/zenn-user-upload/ec6d88497429-20250208.png =400x) |

検索キーワードの提案ではなく、グラウンディングによって情報の信頼性をある程度担保しつつ、症状に対する対処法を提案することは技術的には可能であると考えられます。
https://cloud.google.com/vertex-ai/generative-ai/docs/multimodal/ground-gemini?hl=ja

しかし、現代の生成 AI では 100%の信頼性は担保できないため、健康被害が発生する可能性のある対処法や医療に関する情報を提供することは避けるべきです。

一方で、マタニティ・ベビー用品を扱っている会社や産婦人科、妊娠や出産・育児のお役立ち情報サイトなどでは、様々な症状やその対処法に関する情報が提供されています。
大抵の場合は専門家の監修のもとに作成されているため、信頼性は高いとされています。

例えば、冷え性について検索すると様々な信頼性が高いと思われる情報が得られます。
https://www.google.com/search?q=妊婦+冷え性+原因

Google の検索結果は必ずしも真実が優先されているわけではないはずなので、情報の信頼性には注意が必要ですが、生成 AI を用いた情報提供よりは信頼性が高いと考えています。

BLOOMS による検索キーワードの提案は、ユーザがブラウザで調べるまでの手間を省き、その後の行動はユーザ次第とすることで、情報の信頼性をある程度担保することができると考えています。

### 記録の要約

BLOOMS は一定の期間における記録を要約する機能があります。この機能のことを「ハイライト」と呼んでいます。

| 新しいハイライトを作成                                                                                     | 概要                                                                                                         | 詳細                                                                                                         |
| ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------ |
| ![新しいハイライトを作成](https://storage.googleapis.com/zenn-user-upload/a4b03278def6-20250208.png =400x) | ![当日の記録を要約した概要](https://storage.googleapis.com/zenn-user-upload/2d169fb2b509-20250208.png =400x) | ![当日の記録を要約した詳細](https://storage.googleapis.com/zenn-user-upload/8897af84cc32-20250208.png =400x) |

これは今週を振り返るために利用したり、妊婦健診の際に役に立つのではないかと考えています。

妊娠中は、妊娠週数によって 1〜4 週間に 1 回のペースで妊婦健診を受けることが標準的とされています。私も何度か付いていきました。
https://www.mhlw.go.jp/bunya/kodomo/boshi-hoken13/

妊婦健診には問診があり、体調について尋ねられることがあります。
ハイライト機能はこの問診において、最近の数週間でどのような体調の変化があったのか、どのような出来事があったのかを医師に相談する際の参考になると考えています。

例えば、便秘は妊娠中によくある症状の一つとされています。便秘薬が処方されることもありますが、食物繊維や水分の摂取を意識することで改善できる場合もあるとされています。
https://brand.taisho.co.jp/colac/benpi/006/
食物繊維や水分の摂取について記録しておけば、ハイライト機能によって便秘の改善に対する効果を確認することができたり、医師に相談する際の参考になる可能性があると考えています。

#### 妻の 1 週間のハイライト

実際に、妻の記録で作成した 1 週間のハイライトをご紹介します。1 週間を通しての出来事を大まかに把握できることがわかります。

| 1 週間のハイライト                                                                                        | 1 週間のハイライトの詳細                                                                                        |
| --------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| ![妻の1週間のハイライト](https://storage.googleapis.com/zenn-user-upload/ce001b2810db-20250208.png =400x) | ![妻の1週間のハイライトの詳細](https://storage.googleapis.com/zenn-user-upload/98a774f5fa26-20250208.png =400x) |

## システムアーキテクチャ図

![BLOOMS システムアーキテクチャ図](https://storage.googleapis.com/zenn-user-upload/18ce49a1c12f-20250209.png)

クライアントは Flutter、バックエンドは Firebase を利用しています。

### Flutter

BLOOMS は Flutter で開発されています。Flutter は様々なプラットフォームに対応していますが、開発期間の時間的制約もあり、iOS と Web のみの対応としました。

Web においては Wasm を利用しています。
Wasm は 2024 年 8 月にリリースされた Flutter 3.24 で安定版として利用できるようになっていましたが、当時は iOS では利用できませんでした。その後、2024 年 12 月にリリースされた [iOS 18.2 で遂にサポートされた](https://developer.apple.com/documentation/safari-release-notes/safari-18_2-release-notes)ため、せっかくなので Wasm を有効にしています。
https://docs.flutter.dev/platform-integration/web/wasm

#### デザイン

Flutter は基本的には Material Design ですが、Apple ライクなデザインである Cupertino も実装されています。2024 年 12 月にリリースされた Flutter 3.27 では、チェックボックスやボタンなどの[忠実度が向上しました。](https://medium.com/flutter/whats-new-in-flutter-3-27-28341129570c)
https://docs.flutter.dev/ui/widgets/cupertino

せっかくならばと思い、BLOOMS は Cupertino ウィジェットをベースに実装しました。
とはいえ、全てのコンポーネントが実装されているわけではないため、一部のコンポーネントはサードパーティのものを利用しています。

### バックエンド

#### Firebase Authentication

様々な認証方法が利用できますが、匿名認証のみを採用しています。
https://firebase.google.com/docs/auth/flutter/anonymous-auth?hl=ja

これは、Google アカウントやソーシャルアカウントによる認証を導入すると、それらのアカウントとユーザの記録が紐付くことになってしまうためです。ユーザが妊娠していることや健康状態などを記録することになるので、プライバシーは重要だと考えています。

#### Cloud Functions

Vertex AI API for Gemini にリクエストを送って、ユーザの記録に対する回答やハイライトの生成などに利用しています。
これらの関数は、Firebase への[データ書き込みをトリガーとして実行](https://firebase.google.com/docs/functions/firestore-events?hl=ja&gen=2nd)されるように設定されています。

また、ユーザは画像での記録も行うことができますが、画像は Cloud Functions でリサイズ、WebP への変換、[BlurHash](https://blurha.sh/)の生成、Cloud Storage への保存を行っています。

#### Firebase Hosting

BLOOMS の Web 版と [Widgetbook](https://www.widgetbook.io/open-source) をホストしています。

Widgetbook は UI カタログの一種であり、以下の URL で公開しています。
https://widgetbook.blooms.kingu.dev/

UI コンポーネントの確認がブラウザでできるのは、Web に対応している Flutter ならではと言えるでしょう。

#### データの物理削除

ユーザが記録を削除する操作を行うと、特定の Firestore ドキュメントのフィールドに現在時刻を書き込み、Cloud Firestore の TTL ポリシーを利用することで物理削除を行っています。

個人的にあまり知られていないように思いますが、TTL ポリシーは特定のフィールドを有効期限として設定することで、時間が経過すると自動的にデータを削除する機能です。
https://firebase.google.com/docs/firestore/ttl?hl=ja

ユーザがアプリでアカウントを削除する操作を行なった場合は、特定の Firestore ドキュメントのフィールドに現在時刻を書き込みます。このフィールドに値があるアカウントを、Cloud Functions で[Admin SDK](https://firebase.google.com/docs/admin/setup?hl=ja)を用いて Firebase Authentication から定期的に削除します。
削除をトリガーとして [Delete User Data](https://firebase.google.com/docs/extensions/official/delete-user-data?hl=ja) が実行され、関連するデータを物理削除します。

#### その他

以下については文字数制限の関係で割愛します。

- Cloud Firestore
- Cloud Storage
- App Check
- Crashlytics

### 生成 AI

Vertex AI の Gemini 2.0 Flash を利用しています。BLOOMS を開発し始めた時点では試験運用版の Gemini 2.0 Flash を利用していましたが、2025 年 2 月 5 日に一般提供となりました。
https://developers.googleblog.com/en/gemini-2-family-expands/

システム指示の一例は以下です。粗は感じているので、まだ改善の余地があると考えています。
https://github.com/KoheiKanagu/blooms/blob/v1.0.1/firebase/functions/src/features/condition/application/setupGenerativeModel.ts

### ソースコード

こちらから確認できます。`v1.0.1`のタグ時点がハッカソン提出時のバージョンです。
https://github.com/KoheiKanagu/blooms/tree/v1.0.1

## BLOOMS という名称について

BLOOMS の正式名称は「Body Log Observation and Outlook for Maternal State」であり、日本語だと「母体の体の状態の観察と展望」のような意味合いです。
また「BLOOMS」は「花が咲く」といった意味になります。

ここで言う「花」とは赤ちゃんをイメージしており、出産という出来事を花が咲くと捉えて命名しました。

ちなみに、サービスの名称を英文の頭文字で表現することはよくありますが、私は英語が得意ではないため、Gemini に考えてもらいました。
アイコンは Gemini の[Imagen](https://deepmind.google/technologies/imagen-3/)で生成されたものをベースに、手動でベクター化しました。

| light                                                                                              | dark                                                                                               |
| -------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| ![ライトアイコン](https://storage.googleapis.com/zenn-user-upload/338fe92cd5d2-20250209.png =256x) | ![ダークアイコン](https://storage.googleapis.com/zenn-user-upload/ccc445e0a7b9-20250209.png =256x) |

## 費用について

Firebase は[1 ヶ月あたりの無料枠が充実](https://firebase.google.com/pricing?hl=ja)しているため、ある程度のユーザ数まではほぼ無料で運用できると予想しています。
Gemini 2.0 Flash は無料枠こそありませんが、[100 万トークンあたり$0.10 という価格設定](https://developers.googleblog.com/en/gemini-2-family-expands/)です。

妻の実際の 1 週間の記録をもとにして、非常にざっくりと試算してみました。

妻は 1 週間で 16 回の短文のテキストの記録、画像の記録が 7 回あったため、約 15,000 トークンであると推測されます。また、ハイライトで週 1 回、過去 7 日間の記録を要約する場合、約 4,000 トークンであると推測されます。

妻と同じぐらいの利用頻度のユーザが 1 万人と仮定すると、`((15000+4000)*4*10000)/1000000*0.10 = 76ドル/月`となります。
ユーザ一人あたりののランニングコストが 1 円以下は非常に安価だと思います。（1 万ユーザもいる場合は Firebase の無料枠は超えているはずですので、実際にはもう少し高くなると思われます）

## 今後の展望

以下のような展望を考えています。

- BLOOMS の回答が 👍 か 👎 のフィードバック
- 音声での記録
- ハイライトの種類の拡充
- ユーザのパートナーと記録の共有
- [Passkey](https://support.apple.com/ja-jp/guide/iphone/iphf538ea8d0/ios) のサポート
- [ウィジェット](https://developer.apple.com/jp/widgets/)のサポート
- マネタイズの仕組みの検討

妻には引き続き利用してもらっており、フィードバックをもらいながら改善を進めていきたいと考えています。

## おわりに

今回のハッカソンの参加をきっかけに、初めて"AI エージェント"を用いたサービスを開発しました。
[GitHub Copilot](https://docs.github.com/ja/copilot/about-github-copilot/what-is-github-copilot#getting-access-to-copilot)は以前から利用しており、その可能性は感じていましたが、実際に生成 AI を用いたサービスを開発したことで、新しい技術に触れる良い機会になりました。

BLOOMS で活用している Flutter のテクニックについても語りたいのは山々ですが、字数制限のため割愛します。需要があれば別途記事にするかもしれません。

拙い文章ではありましたが、最後までお付き合いいただき、ありがとうございました。
