---
title: "ã¡ã‚‡ã£ã¨`flutter build`ã—ãŸããªã£ãŸæ™‚å‘ã‘ã®Codespaces"
emoji: "ğŸ“¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [flutter, github]
published: true
---

# ã¯ã˜ã‚ã«

ã¡ã‚‡ã£ã¨ã ã‘ç›´ã—ã¦`flutter build`ã‚„`flutter pub get`ã—ãŸã„ãªãã€‚ãã†ã„ã£ãŸã“ã¨ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ
ç§ã¯ã‚ã‚Šã¾ã™ã€‚

## ä½™è«‡

ç‰¹ã«ã“ã“æœ€è¿‘ dependabot ã® PR ã§`pubspec.lock`ã® sha256 ã‚’æ¶ˆã—ã¦ã—ã¾ã†ã®ã§ã€`git diff`ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚

https://github.com/KoheiKanagu/kingu_dev/pull/180/commits/517a3106d66f7ddbf55a12867ddda940bce93445

`pubspec.lock`ã« sha256 ãŒè¿½åŠ ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã¯æœ€è¿‘ã®ã“ã¨ãªã®ã§ã€dependabot ãŒä½¿ã£ã¦ã„ã‚‹ Dart ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸ŠãŒã‚Œã°è§£æ±ºã™ã‚‹ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚
[\[pub\] : Dependabot fails after upgrading flutter Â· Issue \#6867 Â· dependabot/dependabot\-core](https://github.com/dependabot/dependabot-core/issues/6867)

ãŒã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å¾…ã£ã¦ã‚‰ã‚Œãªã„ã®ã§ã€æ‰‹å‹•ã§`flutter pub get`ã—ã¦`pubspec.lock`ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆGithub Actions ã‚’ä½¿ã£ã¦`flutter pub get`ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãã‚Œã¯ã¾ãŸåˆ¥ã®ãŠè©±ã€‚ï¼‰

è¦ã¯å¯¾è±¡ã® PR ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¦`flutter pub get`ã‚„ãã®ä»–`flutter`ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã§ãã‚Œã°ã§ãã‚Œã°ã„ã„ã®ã§ã™ã€‚

# ãã‚“ãªæ™‚ã« Codespaces

Codespaces ã¯`.devcontainer`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã ã‘ã§ VS Code ã®ãƒªãƒ¢ãƒ¼ãƒˆé–‹ç™ºç’°å¢ƒãŒç°¡å˜ã«ä½œã‚Œã‚‹ã®ã§ã€ä½¿ã„æ¨ã¦ã‚‹ç’°å¢ƒã‚’ä½œã‚‹ã®ã«ã¯æœ€é©ã§ã™ã€‚

## ä¾‹

https://github.com/KoheiKanagu/kingu_dev/tree/main/.devcontainer

```json:.devcontainer/devcontainer.json
{
  "name": "kingu_dev",
  "image": "mcr.microsoft.com/vscode/devcontainers/base:debian",
  "customizations": {
    "vscode": {
      "extensions": [
        "Dart-Code.dart-code",
        "Dart-Code.flutter",
        "esbenp.prettier-vscode",
        "foxundermoon.shell-format",
        "timonwong.shellcheck",
        "redhat.vscode-yaml"
      ],
      "settings": {
        "dart.flutterSdkPath": "/home/vscode/flutter/bin"
      }
    }
  },
  "updateContentCommand": ".devcontainer/bootstrap.sh",
  "containerEnv": {
    "FLUTTER_HOME": "/home/vscode/flutter/bin"
  },
  "remoteEnv": {
    "PATH": "${containerEnv:PATH}:${containerEnv:FLUTTER_HOME}:/home/vscode/.pub-cache/bin"
  },
  "features": {
    "ghcr.io/devcontainers/features/sshd:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {}
  },
  "remoteUser": "vscode"
}
```

```sh:.devcontainer/bootstrap.sh
#!/bin/bash
set -euxo pipefail

# Flutter
CHANNEL="beta" # or "stable"

TAGS=$(gh api repos/flutter/flutter/git/refs/tags --paginate | jq -r '.[].ref' | sed 's/refs\/tags\///' | grep '^[0-9].*')

## Search latest tag
if [ "$CHANNEL" = "beta" ]; then
    TARGET_TAG=$(echo "$TAGS" | grep '\.pre$' | sort -V | tail -n 1)
elif [ "$CHANNEL" = "stable" ]; then
    TARGET_TAG=$(echo "$TAGS" | grep -v '\.pre$' | sort -V | tail -n 1)
else
    echo "CHANNEL is invalid."
    exit 1
fi

## Install Flutter
if [ -d "$FLUTTER_HOME" ]; then
    git -C "$FLUTTER_HOME" checkout "$TARGET_TAG"
else
    git clone https://github.com/flutter/flutter.git --depth 1 --branch "$TARGET_TAG" "$HOME/flutter"
fi

flutter --version

flutter pub global activate melos
flutter pub global activate grinder
```

### ã–ã£ãã‚Šè§£èª¬

`devcontainer.json`ã§è¨­å®šã§ãã‚‹é …ç›®ã®è©³ç´°ã¯ [Dev Container metadata reference](https://containers.dev/implementors/json_reference/) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### `customizations.vscode.extensions`

ã“ã®ã‚³ãƒ³ãƒ†ãƒŠã§å¿…è¦ã¨ã—ã¦ã„ã‚‹ VS Code ã® Extensions ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

Flutter ã«ãŠã„ã¦å¿…é ˆãªã®ã¯`Dart-Code.dart-code`ã¨`Dart-Code.flutter`ã ã‘ãªã®ã§ã€ãã‚Œä»¥å¤–ã¯ãŠå¥½ã¿ã§è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

#### `customizations.vscode.settings`

ã“ã®ã‚³ãƒ³ãƒ†ãƒŠã«ãŠã‘ã‚‹ VS Code ã®è¨­å®šã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

ã“ã®ä¾‹ã§ã¯ Flutter SDK ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

#### `updateContentCommand`

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½œæˆæ™‚ã¨ãã‚Œä»¥é™ã®æ›´æ–°æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã€ã“ã®ä¾‹ã§ã¯`bootstrap.sh`ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

- [Dev Container metadata reference](https://containers.dev/implementors/json_reference/#lifecycle-scripts)
- [ãƒ—ãƒ¬ãƒ“ãƒ«ãƒ‰ã®æ§‹æˆ \- GitHub Docs](https://docs.github.com/ja/codespaces/prebuilding-your-codespaces/configuring-prebuilds#configuring-time-consuming-tasks-to-be-included-in-the-prebuild)

#### `containerEnv`ã¨`remoteEnv`

ãƒ‘ã‚¹ã‚’é€šã—ã¾ã™ã€‚

`${containerEnv:FLUTTER_HOME}`ã‚„`${containerEnv:PATH}`ã‚ãŸã‚ŠãŒåˆ†ã‹ã‚Šã«ãã„ã§ã™ãŒã€æœ€çµ‚çš„ã«ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯ãã‚Œãã‚Œæ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```sh
@KoheiKanagu âœ /workspaces/kingu_dev (main) $ echo $FLUTTER_HOME
/home/vscode/flutter/bin
@KoheiKanagu âœ /workspaces/kingu_dev (main) $ echo $PATH
/home/vscode/flutter/bin/:/vscode/bin/linux-x64/b3e4e68a0bc097f0ae7907b217c1119af9e03435/bin/remote-cli:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/vscode/flutter/bin:/home/vscode/.pub-cache/bin:/home/vscode/.local/bin
```

ä¾‹ã§ã¯`/home/vscode/.pub-cache/bin`ã‚‚ãƒ‘ã‚¹ã«è¿½åŠ ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯`flutter pub global activate`ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ãªã®ã§ã€å¿…è¦ãªã‘ã‚Œã°å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚

#### `features`

ã“ã‚Œã‚‚å¿…é ˆã§ã¯ãªã„ã®ã§ã€ãŠå¥½ã¿ã§å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

# ãŠã‚ã‚Šã«

Codespaces ã®ã‚¹ãƒšãƒƒã‚¯ã¯ãã“ã¾ã§å¼·ããªã„ã®ã§ã¯ãªã„ã®ã§ã€ãƒ“ãƒ«ãƒ‰ç­‰ã¯é…ã„ã§ã™ã€‚

[ã¤ã‚ˆã¤ã‚ˆ 32 ã‚³ã‚¢](https://docs.github.com/ja/billing/managing-billing-for-github-codespaces/about-billing-for-github-codespaces#pricing-for-paid-usage)ã«ã™ã‚Œã°å¿«é©ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã‚¬ãƒƒãƒ„ãƒªé–‹ç™ºã™ã‚‹ãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã®æ–¹ãŒå¿«é©ã®ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚

ãªãŠã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè¡Œç’°å¢ƒãŒã‚ã‚‹å ´åˆã¯ [Dev Containers: Clone Repository in Container Volume...](https://code.visualstudio.com/docs/devcontainers/containers#_quick-start-open-a-git-repository-or-github-pr-in-an-isolated-container-volume) ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠä½œã‚Œã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’ä½¿ã†ã®ã‚‚æ‰‹ã§ã™ã€‚
